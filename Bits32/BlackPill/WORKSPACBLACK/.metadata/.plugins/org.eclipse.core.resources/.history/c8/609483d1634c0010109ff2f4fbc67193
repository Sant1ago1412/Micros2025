
#include <ctype.h>

int main(void){

  ESP01_Check_Credentials("InternetPlus_bed788", "wlan412877", "192.168.1.10");

}

static int is_valid_ip(const char* ip) {
    if (ip == NULL) return 0;

    // Hacemos una copia local modificable para strtok
    char ip_copy[16];
    strncpy(ip_copy, ip, sizeof(ip_copy) - 1);
    ip_copy[sizeof(ip_copy) - 1] = '\0';  // Garantizar terminación

    int dots = 0;
    char *ptr = strtok(ip_copy, ".");

    while (ptr != NULL) {
        // Verificar que solo haya dígitos
        for (size_t i = 0; ptr[i]; ++i) {
            if (!isdigit((unsigned char)ptr[i])) return 0;
        }

        // Convertir a número y verificar rango
        long num = strtol(ptr, NULL, 10);
        if (num < 0 || num > 255) return 0;

        // Prevenir ceros a la izquierda (ej: "01" o "001")
        if (ptr[0] == '0' && strlen(ptr) > 1) return 0;

        ptr = strtok(NULL, ".");
        dots++;
    }

    return (dots == 4);
}

static uint8_t ESP01_Check_Credentials(const char* ssid, const char* password, const char* ip) {
    // Validar SSID
    if (ssid == NULL) return 0;
    size_t ssid_len = strlen(ssid);
    if (ssid_len < 1 || ssid_len > 32) return 0;

    // Validar contraseña (WPA-PSK requiere entre 8 y 63 caracteres)
    if (password == NULL) return 0;
    size_t pass_len = strlen(password);
    if (pass_len != 0 && (pass_len < 8 || pass_len > 63)) return 0;

    // Validar IP
    if (ip == NULL || !is_valid_ip(ip)) return 0;

  return 1;
}
